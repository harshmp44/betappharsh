<!DOCTYPE html>
<html translate="no" data-dpr="1" style="font-size: 49.36px;">

<head>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.2/firebase-auth.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="robots" content="noindex,nofollow">
    <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport">
    <title>Color1</title>
    <link href="/css/account/chunk-vendors.css" rel="stylesheet" />
    <link href="/css/account/app.css" rel="stylesheet" />
    <link href="/css/account/chunk-3abb8cfe.27bda068.css" rel="stylesheet" />
    <link rel="shoratcut icon" href="/images/bitbug_favicon.ico" type="image/x-icon" />
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            background-color: #090909;
            padding: 0;
            margin: 0;
        }

        a .msg-content {
            animation: zoom-in 0.45s ease reverse;
        }

        .block-click {
            pointer-events: none;
        }

        @keyframes zoom-in {
            0% {
                opacity: 1;
                transform: scale(1, 1);
            }

            50% {
                transform: scale(0.6, 0.6);
            }

            100% {
                opacity: 0;
                transform: scale(1, 1);
            }
        }

        /* body {
      font-family: Arial, sans-serif;
      background-color: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    } */
        .container {
            /* background: #fff; */
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        h2 {
            text-align: center;
            margin-bottom: 20px;
        }

        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ddd;
            box-sizing: border-box;
            color: black;
        }


        .hidden {
            display: none;
        }

        input {
            width: 80%;
            height: 1.17333rem;
            margin-left: 2.66667rem;
            padding: .36rem .34667rem;
            /* background: #484848; */
            /* color: #fff; */
            font-size: .37333rem;
            border: none;
            border-radius: .26667rem;
            outline: none;
        }

        .center_div {
            /* display: flex; */
            /* width: 80%; */
            /* justify-content: center; */
            width: 100%;
            padding-left: 10px;
            padding-right: 20px;
        }

        .btn-otp {
            width: 7.73333rem;
            height: 1.06667rem;
            color: #c4933f;
            font-size: .48rem;
            background: transparent;
            border-radius: 1.06667rem;
            border: .01333rem solid #C4933F;
            box-shadow: none;
            text-shadow: none;
            /* margin-top: .53333rem; */
            background: linear-gradient(180deg, #FAE59F 0%, #C4933F 100%);
            color: #8f5206;
        }
    </style>
</head>

<body style="font-size: 12px;">
    <div id="app">
        <div data-v-51f72da1="" class="mian forgot" style="color: white;
    background: rgb(63, 63, 63);">
            <div data-v-106b99c8="" data-v-51f72da1="" class="navbar"
                style="background: linear-gradient(90deg, #6F7381 0%, #A9AAB5 100%) !important;">
                <div data-v-106b99c8="" class="navbar-left" onclick="location.href='/login'">
                    <div data-v-106b99c8="" class="bank c-row c-row-middle-center">
                        <img data-v-106b99c8="" src="/images/back.c3244ab0.png" class="navbar-back">
                    </div>
                </div>
                <div data-v-106b99c8="" class="navbar-title"> Forgot password</div>
                <div data-v-106b99c8="" class="navbar-right">
                    <div data-v-51f72da1="" data-v-106b99c8="" class="c-row" onclick="location.href='/keFuMenu'">
                        <img data-v-51f72da1="" data-v-106b99c8="" src="/images/audio.webp" class="audio">
                    </div>
                </div>
            </div>
            <div class="center_div">
                <form id="phone-form" style="text-align: center;">
                    <!-- <h2 style="">Forgot Password</h2> -->
                    <div data-v-51f72da1="" class="item c-row c-row-center c-row-middle m-t-15 m-b-30 first">
                        <div data-v-51f72da1="" class="c-row number">
                            <span data-v-51f72da1="" class="c-row c-row-middle-center">
                                <img data-v-51f72da1="" height="22px" width="15px" src="/images/phone.png"
                                    class="mobile">
                            </span>
                            <div data-v-6f85c91a="" class="dropdown__value"><span data-v-6f85c91a="">+91</span></div>
                        </div>
                        <input type="text" id="phone-number" placeholder="Phone number">
                    </div>

                    <div id="recaptcha-container"></div>
                    <button type="button" class="btn-otp" onclick="sendOTP()">Send OTP</button>
                </form>

                <!-- Step 2: Verify OTP -->
                <form id="otp-form" style="display: none; text-align: center;">

                    <!-- <h2 style="color: #fff;font-size: .4rem;">Verify OTP</h2> -->
                    <input type="text" id="otp" placeholder="Enter OTP">
                    <button type="button" class="btn-otp" onclick="verifyOTP()">Verify OTP</button>
                </form>

                <!-- Step 3: Reset Password -->
                <form id="reset-form" style="display: none; text-align: center;">
                    <h2>Reset Password</h2>
                    <input type="password" id="new-password" placeholder="New Password">
                    <input type="password" id="confirm-password" placeholder="Confirm Password">
                    <button type="button" class="btn-otp" onclick="resetPassword()">Reset Password</button>
                </form>
            </div>
        </div>
        <!---->
        <div data-v-7692a079="" data-v-51f72da1="" class="Loading c-row c-row-middle-center" style="display: none;">
            <div data-v-7692a079="" class="van-loading van-loading--circular">
                <span data-v-7692a079="" class="van-loading__spinner van-loading__spinner--circular"
                    style="width: auto; height: auto; -webkit-animation-duration: 1s; animation-duration: 1s;">
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
                        viewBox="0 0 200 200" width="200" height="200" preserveAspectRatio="xMidYMid meet"
                        style="width: 100%;height: 100%;transform: translate3d(0px, 0px, 0px);content-visibility: visible;">
                        <g transform="matrix(-0.5984085202217102,0.8011911511421204,-0.8011911511421204,-0.5984085202217102,239.9599609375,79.72173309326172)"
                            style="display: block;">
                            <image width="200px" height="200px" preserveAspectRatio="xMidYMid slice"
                                xlink:href="/index_files/loadingspinner.png"></image>
                        </g>
                        <g transform="matrix(0.9408400058746338,0,0,0.9408400058746338,20.969436645507812,79.30152130126953)"
                            style="display: block;">
                            <image width="168px" height="44px" preserveAspectRatio="xMidYMid slice"
                                xlink:href="/index_files/h5setting_202401100608011fs2.png"></image>
                        </g>
                    </svg>
                </span>
            </div>
        </div>
    </div>
    </div>
    <div class="van-overlay" style="z-index: 2003; display: none;"></div>
    <div class="alert-toast"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>

        //firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBFroADUtA0ps70rV2hQeN9H-SoQSp8slI",
            authDomain: "color1-ff027.firebaseapp.com",
            projectId: "color1-ff027",
            storageBucket: "color1-ff027.appspot.com",
            messagingSenderId: "346488744285",
            appId: "1:346488744285:web:fb1c7a74a15d5a7caee0b4"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        function alertMess(text) {
            let length = $('.alert-toast .msg').length;
            if (length == 0) {
                $('.alert-toast').append(
                    `
                    <div data-v-1dcba851="" class="msg">
                        <div data-v-1dcba851="" class="msg-content" style=""> ${text} </div>
                    </div>
                    `
                );
                setTimeout(() => {
                    $('.msg').fadeOut();
                    setTimeout(() => {
                        $('.alert-toast .msg').remove();
                    }, 100);
                }, 1500);
            }
        }

        function validateForm(otp) {
            console.log(otp);
            if (!otp) {
                alertMess("Invalid Number.");
                return false;
            } else {
                console.log('here2')
                if (otp.length > 10 || otp.length < 10) {
                    alertMess("Invalid Number.");
                    return false;
                }
                return true;
            }
        }

        var appVerifier;

        // window.onload = function () {
        //     appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
        //         'size': 'invisible',
        //         'callback': function (response) {
        //             // reCAPTCHA solved, allow sendOTP to proceed
        //             sendOTP();
        //         }
        //     });
        //     appVerifier.render();
        // };

        // function sendOTP() {
        //     let phoneNumber = document.getElementById('phone-number').value;

        //     if (validateForm(phoneNumber)) {
        //         console.log('here1');
        //         $('.van-overlay').fadeIn(10);
        //         console.log('here3');
        //         $.ajax({
        //             type: "POST",
        //             url: "/api/userExists",
        //             data: {
        //                 username: phoneNumber,
        //                 otp: otp,
        //                 pwd: '',
        //             },
        //             dataType: "json",
        //             success: function (response) {
        //                 console.log('response', response)
        //                 if (response.status === true) {
        //                     $('.van-overlay').fadeOut(300);
        //                     $('.Loading').fadeIn(10);
        //                     // setTimeout(() => {
        //                     //     $('.Loading').fadeOut(10);
        //                     //     alertMess(response.message);
        //                     // }, 100);

        //                     let phoneNumber = '+91' + document.getElementById('phone-number').value;
        //                     //   var appVerifier = new firebase.auth.RecaptchaVerifier('send-otp-button');

        //                     firebase.auth().signInWithPhoneNumber(phoneNumber, appVerifier)
        //                         .then(function (confirmationResult) {
        //                             window.confirmationResult = confirmationResult;
        //                             document.getElementById('phone-form').classList.add('hidden');
        //                             document.getElementById('otp-form').classList.remove('hidden');
        //                             $('.van-overlay').fadeOut(300);
        //                         }).catch(function (error) {
        //                             console.error(error);
        //                             alertMess(error.message);
        //                         });

        //                 } else {
        //                     $('.van-overlay').fadeOut(300);
        //                     alertMess(response.message);
        //                 }
        //             },
        //             error:(err)=>{
        //                 console.log('err', err);
        //             }
        //         }).catch((err)=>{
        //             console.log('err',err);
        //         });


        //     }

        // }


        // Global reCAPTCHA verifier variable
        var appVerifier;

        window.onload = function () {
            appVerifier = new firebase.auth.RecaptchaVerifier('recaptcha-container', {
                'size': 'invisible',
                'callback': function (response) {
                    // reCAPTCHA solved, allow sendOTP to proceed
                }
            });
            appVerifier.render();
        };

        function sendOTP() {
            let phoneNumber = document.getElementById('phone-number').value;

            if (validateForm(phoneNumber)) {
                $('.van-overlay').fadeIn(10);

                $.ajax({
                    type: "POST",
                    url: "/api/userExist",
                    data: {
                        username: phoneNumber,
                        otp: '',
                        pwd: ''
                    },
                    dataType: "json",
                    success: function (response) {
                        if (response.status === true) {
                            $('.van-overlay').fadeOut(300);
                            // $('.Loading').fadeIn(10);

                            console.log("response", response);
                            let fullPhoneNumber = '+91' + phoneNumber;

                            firebase.auth().signInWithPhoneNumber(fullPhoneNumber, appVerifier)
                                .then(function (confirmationResult) {
                                    console.log("confirmationResult", confirmationResult);
                                    window.confirmationResult = confirmationResult;
                                    document.getElementById('phone-form').style.display = 'none';
                                    document.getElementById('otp-form').style.display = 'block';

                                    // document.getElementById('phone-form').classList.add('hidden');
                                    // document.getElementById('otp-form').classList.remove('hidden');
                                    $('.van-overlay').fadeOut(300);
                                }).catch(function (error) {
                                    console.error(error);
                                    alertMess(error.message);
                                });

                        } else {
                            $('.van-overlay').fadeOut(300);
                            alertMess(response.message);
                        }
                    },
                    error: function (err) {
                        console.log('err', err);
                        alertMess('An error occurred. Please try again.');
                    }
                });
            }
        }


        function verifyOTP() {
            var otp = document.getElementById('otp').value;
            window.confirmationResult.confirm(otp).then(function (result) {
                document.getElementById('reset-form').style.display = 'block';
                document.getElementById('otp-form').style.display = 'none';
                // document.getElementById('otp-form').classList.add('hidden');
                // document.getElementById('reset-form').classList.remove('hidden');
            }).catch(function (error) {
                console.error(error);
                alertMess('Authentication Failed!');
            });
        }

        function resetPassword() {
            var newPassword = document.getElementById('new-password').value;
            var confirmPassword = document.getElementById('confirm-password').value;

            if (newPassword !== confirmPassword) {
                alert("Passwords do not match.");
                return;
            }

            var user = firebase.auth().currentUser;

            let username = document.getElementById('phone-number').value;
            let otp = $('#otp').val().trim();
            let password = document.getElementById('new-password').value

            $('.van-overlay').fadeIn(10);
            $.ajax({
                type: "POST",
                url: "/api/resetPasword",
                data: {
                    username: username,
                    otp: otp,
                    pwd: password,
                },
                dataType: "json",
                success: function (response) {
                    if (response.status === true) {
                        $('.van-overlay').fadeOut(300);
                        $('.Loading').fadeIn(10);
                        setTimeout(() => {
                            $('.Loading').fadeOut(10);
                            alertMess(response.message);
                        }, 100);
                        setTimeout(() => {
                            location.href = '/login';
                        }, 900);
                    } else {
                        $('.van-overlay').fadeOut(300);
                        alertMess(response.message);
                    }
                }
            });
        }

    </script>
    <script>
        let getWBody = $('.mian').width();

        $('html').css('font-size', `${getWBody / 10}px`);
        $('.van-tabbar .van-tabbar-item').css({
            'transform': 'scale(0.9)',
        });
        $(window).resize(() => {
            let getWBody = $('.mian').width();
            $('html').css('font-size', `${getWBody / 10}px`);
            $('.van-tabbar .van-tabbar-item').css({
                'transform': 'scale(0.9)',
            });
        });
    </script>
</body>

</html>